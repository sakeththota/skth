---
import { getCollection } from 'astro:content';
import '@/styles/globals.css';
import { ModeToggle } from '@/components/ModeToggle';
import { GET } from './api/spotify/now-playing';

const latestPosts = (await getCollection('blog', ({ data }) => !data.hidden))
  .sort((a, b) => b.data.idx - a.data.idx)
  .slice(0, 4);

const projects = (await getCollection('projects', ({ data }) => !data.hidden))
  .sort((a, b) => b.data.id - a.data.id);

const currentProject = projects[0];
const nowPlaying = await (await GET(Astro)).json();

const menuItems = [
  { title: "Tutoring", path: "/tutoring" },
  { title: "Resume", path: "/resume" },
  { title: "Projects", path: "/projects" },
  { title: "Blog", path: "/blog" },
];

const socialLinks = [
  { label: "GitHub", handle: "sakeththota", url: "https://github.com/sakeththota" },
  { label: "LinkedIn", handle: "saketh-thota", url: "https://linkedin.com/in/saketh-thota" },
  { label: "Instagram", handle: "@ssakethh", url: "https://instagram.com/ssakethh" },
  { label: "Spotify", handle: "Saketh Thota", url: "https://open.spotify.com/user/ewh7myvj13dio09ye08z9ufqn" },
];
---

<script is:inline>
  const getThemePreference = () => {
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      return localStorage.getItem('theme');
    }
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  };
  const isDark = getThemePreference() === 'dark';
  document.documentElement.classList[isDark ? 'add' : 'remove']('dark');
  if (typeof localStorage !== 'undefined') {
    const observer = new MutationObserver(() => {
      const isDark = document.documentElement.classList.contains('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });
    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
  }
</script>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <title>Saketh Thota â€” 01</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap');

      :root {
        --fd-accent: #C2410C;
        --fd-bg: #FAFAF9;
        --fd-fg: #0C0A09;
        --fd-muted: #57534E;
        --fd-border: #0C0A09;
        --fd-surface: #F5F5F4;
        --fd-border-light: #D6D3D1;
      }
      .dark {
        --fd-accent: #F59E0B;
        --fd-bg: #0C0A09;
        --fd-fg: #FAFAF9;
        --fd-muted: #A8A29E;
        --fd-border: #FAFAF9;
        --fd-surface: #1C1917;
        --fd-border-light: #292524;
      }

      .fd-body { font-family: 'Inter', system-ui, sans-serif; background-color: var(--fd-bg); color: var(--fd-fg); }
      .fd-mono { font-family: 'JetBrains Mono', monospace; }

      .fd-hero {
        font-size: clamp(3rem, 11vw, 9rem);
        font-weight: 900;
        line-height: 0.88;
        letter-spacing: -0.05em;
        text-transform: uppercase;
      }

      .fd-rule-thick { height: 3px; background-color: var(--fd-fg); }
      .fd-rule-accent { height: 3px; background-color: var(--fd-accent); }

      .fd-nav {
        position: relative;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.6875rem; font-weight: 600;
        letter-spacing: 0.12em; text-transform: uppercase;
        color: var(--fd-muted); text-decoration: none;
        padding-bottom: 4px; transition: color 0.2s ease;
      }
      .fd-nav:hover { color: var(--fd-fg); }
      .fd-nav::after {
        content: ''; position: absolute; left: 0; bottom: 0;
        width: 0; height: 2px; background-color: var(--fd-accent);
        transition: width 0.2s ease;
      }
      .fd-nav:hover::after { width: 100%; }

      .fd-label {
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.625rem; font-weight: 500;
        letter-spacing: 0.2em; text-transform: uppercase;
        color: var(--fd-muted);
      }

      .fd-spotify { background-color: var(--fd-surface); border-top: 2px solid var(--fd-accent); }
      .fd-spotify a { color: var(--fd-fg); text-decoration: none; transition: color 0.15s ease; }
      .fd-spotify a:hover { color: var(--fd-accent); }

      .fd-post {
        display: grid; grid-template-columns: 1fr auto; gap: 1rem;
        align-items: start; padding: 1rem 0;
        border-bottom: 1px solid var(--fd-border-light);
        text-decoration: none; color: inherit;
        transition: padding-left 0.15s ease;
      }
      .fd-post:hover { padding-left: 0.5rem; }
      .fd-post:hover .fd-post-title { color: var(--fd-accent); }
      .fd-post-title { transition: color 0.15s ease; }

      .fd-tag {
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.5625rem; font-weight: 600;
        letter-spacing: 0.1em; text-transform: uppercase;
        padding: 2px 8px; background-color: var(--fd-surface);
        color: var(--fd-muted); border: 1px solid var(--fd-border-light);
      }

      .fd-btn {
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.6875rem; font-weight: 700;
        letter-spacing: 0.15em; text-transform: uppercase;
        padding: 0.5rem 1.25rem; border: 2px solid var(--fd-fg);
        background: transparent; color: var(--fd-fg);
        text-decoration: none; transition: all 0.15s ease;
      }
      .fd-btn:hover { background: var(--fd-accent); border-color: var(--fd-accent); color: #0C0A09; }

      .fd-project-stripe {
        border-top: 4px solid var(--fd-accent);
        border-left: 1px solid var(--fd-border-light);
        border-right: 1px solid var(--fd-border-light);
        border-bottom: 1px solid var(--fd-border-light);
      }

      /* Right panel: minimal vertical stack with rules */
      .fd-panel-row {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        padding: 0.625rem 0;
        border-bottom: 1px solid var(--fd-border-light);
        text-decoration: none;
        color: inherit;
        transition: color 0.15s ease;
      }
      a.fd-panel-row:hover .fd-panel-value {
        color: var(--fd-accent);
      }
      .fd-panel-value {
        transition: color 0.15s ease;
      }
      .fd-panel-cta {
        display: inline-block;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.6875rem; font-weight: 700;
        letter-spacing: 0.15em; text-transform: uppercase;
        color: var(--fd-accent); text-decoration: none;
        padding-top: 0.75rem;
        transition: color 0.15s ease;
      }
      .fd-panel-cta:hover {
        color: var(--fd-fg);
      }
    </style>
  </head>
  <body class="fd-body antialiased min-h-screen flex flex-col">

    <header class="px-6 lg:px-12 py-5 flex items-center justify-between">
      <a href="/1" class="text-lg font-black tracking-[-0.03em] uppercase">Saketh Thota</a>
      <div class="flex items-center gap-8">
        <nav class="hidden md:flex items-center gap-5">
          {menuItems.map((item) => (
            <a href={item.path} class="fd-nav">{item.title}</a>
          ))}
        </nav>
        <ModeToggle client:load />
      </div>
    </header>

    <div class="fd-rule-thick"></div>

    {nowPlaying.isPlaying && (
      <div class="fd-spotify px-6 lg:px-12 py-3 flex items-center gap-3">
        <span class="inline-block w-2 h-2 animate-pulse" style="background-color: var(--fd-accent);"></span>
        <span class="fd-mono text-xs" style="color: var(--fd-muted);">NOW PLAYING</span>
        <a href={nowPlaying.songUrl} class="fd-mono text-xs" target="_blank" rel="noopener noreferrer">
          {nowPlaying.title} &mdash; {nowPlaying.artist}
        </a>
      </div>
    )}

    {/* --- HERO + RIGHT PANEL --- */}
    <section class="px-6 lg:px-12 pt-10 lg:pt-16 pb-8 lg:pb-12">
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12 items-end">
        <div class="lg:col-span-7">
          <div class="fd-hero">
            <span>SAKETH</span><br/>
            <span style="color: var(--fd-accent);">THOTA</span>
          </div>
        </div>
        <div class="lg:col-span-5">
          {/* Role info */}
          <div class="fd-panel-row" style="border-top: 3px solid var(--fd-accent); padding-top: 0.75rem;">
            <span class="fd-label">ROLE</span>
            <span class="fd-mono text-xs font-medium">Software Engineer</span>
          </div>
          <div class="fd-panel-row">
            <span class="fd-label">COMPANY</span>
            <span class="fd-mono text-xs font-medium">The Home Depot</span>
          </div>
          <div class="fd-panel-row">
            <span class="fd-label">FOCUS</span>
            <span class="fd-mono text-xs font-medium">AI & Semantic Search</span>
          </div>
          {/* Social handles */}
          {socialLinks.map((link) => (
            <a href={link.url} class="fd-panel-row" target="_blank" rel="noopener noreferrer">
              <span class="fd-label">{link.label}</span>
              <span class="fd-panel-value fd-mono text-xs font-medium">{link.handle}</span>
            </a>
          ))}
          {/* CTA */}
          <a href="mailto:saketh@umich.edu" class="fd-panel-cta">GET IN TOUCH &rarr;</a>
        </div>
      </div>
    </section>

    {/* --- BIO --- */}
    <section class="px-6 lg:px-12 pb-10 lg:pb-14">
      <div class="max-w-3xl">
        <div class="flex gap-4">
          <div class="w-1 flex-shrink-0" style="background-color: var(--fd-accent);"></div>
          <div>
            <p class="text-sm lg:text-base leading-6 lg:leading-7" style="color: var(--fd-muted);">
              Software engineer at The Home Depot working on AI-assisted semantic search. Passionate about building thoughtful tools and bringing people together.
            </p>
            <p class="text-sm lg:text-base leading-6 lg:leading-7 mt-3" style="color: var(--fd-muted);">
              Leading my fraternity's alumni network in Chicago and tutoring students on the side.
            </p>
          </div>
        </div>
      </div>
    </section>

    <div class="fd-rule-thick"></div>

    {/* --- BLOG --- */}
    <section class="px-6 lg:px-12 py-10 lg:py-14">
      <div class="flex items-center justify-between mb-6">
        <span class="fd-label">RECENT WRITING</span>
        <a href="/blog" class="fd-label hover:text-[var(--fd-accent)]" style="transition: color 0.15s;">VIEW ALL &rarr;</a>
      </div>
      <div>
        {latestPosts.map((post) => (
          <a href={`/blog/${post.id}/`} class="fd-post">
            <div class="min-w-0">
              <div class="flex items-baseline gap-3">
                <span class="fd-post-title text-base lg:text-lg font-bold tracking-tight">{post.data.title}</span>
              </div>
              <p class="text-sm mt-1 hidden md:block" style="color: var(--fd-muted);">{post.data.description}</p>
              <div class="flex gap-2 mt-2">
                {post.data.tags.map((tag: string) => (
                  <span class="fd-tag">{tag}</span>
                ))}
              </div>
            </div>
            <div class="flex flex-col items-end gap-1 flex-shrink-0 pt-1">
              <span class="fd-mono text-xs" style="color: var(--fd-muted);">
                {new Date(post.data.publishedAt).toLocaleDateString('en-us', { month: 'short', day: 'numeric' })}
              </span>
              <span class="fd-mono text-xs" style="color: var(--fd-muted); opacity: 0.6;">
                {new Date(post.data.publishedAt).getFullYear()}
              </span>
            </div>
          </a>
        ))}
      </div>
    </section>

    <div class="fd-rule-thick"></div>

    {/* --- PROJECT --- */}
    <section class="px-6 lg:px-12 py-10 lg:py-14">
      <span class="fd-label block mb-6">CURRENT PROJECT</span>
      {currentProject && (
        <div class="fd-project-stripe overflow-hidden">
          <div class="grid grid-cols-1 lg:grid-cols-5 gap-0">
            <div class="lg:col-span-2 aspect-video lg:aspect-auto overflow-hidden">
              <img src={currentProject.data.src} alt={currentProject.data.title} class="w-full h-full object-cover" />
            </div>
            <div class="lg:col-span-3 p-6 lg:p-8 flex flex-col justify-between">
              <div>
                <h3 class="text-xl lg:text-3xl font-black tracking-tight uppercase mb-3">{currentProject.data.title}</h3>
                <p class="text-sm lg:text-base mb-4" style="color: var(--fd-muted);">{currentProject.data.description}</p>
                <div class="flex flex-wrap gap-2 mb-6">
                  {currentProject.data.tags.map((tag: string) => (
                    <span class="fd-tag">{tag}</span>
                  ))}
                </div>
              </div>
              <div class="flex gap-4">
                <a href={currentProject.data.source} class="fd-btn" target="_blank" rel="noopener noreferrer">SOURCE</a>
                <a href={currentProject.data.live} class="fd-btn" target="_blank" rel="noopener noreferrer">LIVE</a>
              </div>
            </div>
          </div>
        </div>
      )}
    </section>

    <div class="fd-rule-thick"></div>

    <footer class="px-6 lg:px-12 py-5 flex items-center justify-between mt-auto">
      <span class="fd-mono text-xs" style="color: var(--fd-muted);">&copy; {new Date().getFullYear()} SAKETH THOTA</span>
      <span class="fd-mono text-xs" style="color: var(--fd-muted);">CHICAGO, IL</span>
    </footer>

  </body>
</html>
