---
import { ModeToggle } from '@/components/ModeToggle';
import { MobileNav } from '@/components/MobileNav';
import { DesktopSearch } from '@/components/DesktopSearch';
import { DesktopNav } from '@/components/DesktopNav';
import { OpenInNewWindowIcon } from "@radix-ui/react-icons";
import { getCollection } from 'astro:content';

const menuItems = [
  {
    title: "tutoring",
    path: "/tutoring"
  },
  { title: "cv",
    path: "/cv"
  },
  {
    title: "projects",
    path: "/projects"
  },
  {
    title: "blog",
    path: "/blog"
  },
]

const pathname = Astro.url.pathname;

const projects = (await getCollection('projects'))
  .sort((a, b) => a.data.id - b.data.id)
  .map((p) => ({
    title: p.data.title,
    description: p.data.description,
    tags: p.data.tags,
    source: p.data.source,
    live: p.data.live,
  }));

const posts = (await getCollection('blog'))
  .sort((a, b) => a.data.idx - b.data.idx)
  .reverse()
  .map((p) => ({
    title: p.data.title,
    description: p.data.description,
    tags: p.data.tags,
    publishedAt: p.data.publishedAt,
    url: `/blog/${p.slug}/`,
  }));

const services = (await getCollection('services'))
  .map((s) => ({
    Name: s.data.properties.Name,
    Description: s.data.properties.Description,
    Details: s.data.properties.Details,
  }));
---
<header class="mb-10 tracking-tight">
  <div class="lg:sticky lg:top-8 lg:py-4 lg:backdrop-blur-sm lg:bg-background/80">
    <!-- Mobile header row -->
    <div class="flex flex-row items-center justify-between lg:hidden">
      <a href="/" class="hover:text-accent-foreground transition-colors">
        <span class="font-semibold text-2xl">Saketh Thota</span>
      </a>
      <div class="flex gap-2 items-center">
        <ModeToggle client:load />
        <a href="https://github.com/sakeththota/skth" class="inline-flex items-center justify-center h-9 w-9 rounded-md hover:bg-accent transition-colors">
          <OpenInNewWindowIcon className="h-5 w-5"/>
        </a>
        <MobileNav client:load projects={projects} posts={posts} services={services} />
      </div>
    </div>

    <!-- Desktop nav -->
    <nav class="hidden lg:flex lg:items-center lg:justify-between">
      <a href="/" class="text-xl font-semibold inline-flex items-center h-9 hover:text-accent-foreground transition-colors">
        Saketh Thota
      </a>
      <div class="flex items-center gap-8">
        <DesktopNav client:load items={menuItems} pathname={pathname} />
        <div class="flex items-center gap-1">
          <DesktopSearch client:load projects={projects} posts={posts} services={services} />
          <ModeToggle client:load />
          <a href="https://github.com/sakeththota/skth" class="inline-flex items-center justify-center h-9 w-9 text-muted-foreground hover:text-foreground transition-colors">
            <OpenInNewWindowIcon className="h-4 w-4"/>
          </a>
        </div>
      </div>
    </nav>
  </div>
</header>
