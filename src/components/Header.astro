---
import { ModeToggle } from '@/components/ModeToggle';
import { MobileNav } from '@/components/MobileNav';
import { OpenInNewWindowIcon } from "@radix-ui/react-icons";
import { getCollection } from 'astro:content';

const menuItems = [
  {
    title: "tutoring",
    path: "/tutoring"
  },
  { title: "cv",
    path: "/cv"
  },
  {
    title: "projects",
    path: "/projects"
  },
  {
    title: "blog",
    path: "/blog"
  },
]

const projects = (await getCollection('projects'))
  .sort((a, b) => a.data.id - b.data.id)
  .map((p) => ({
    title: p.data.title,
    description: p.data.description,
    tags: p.data.tags,
    source: p.data.source,
    live: p.data.live,
  }));

const posts = (await getCollection('blog'))
  .sort((a, b) => a.data.idx - b.data.idx)
  .reverse()
  .map((p) => ({
    title: p.data.title,
    description: p.data.description,
    tags: p.data.tags,
    publishedAt: p.data.publishedAt,
    url: `/blog/${p.slug}/`,
  }));

const services = (await getCollection('services'))
  .map((s) => ({
    Name: s.data.properties.Name,
    Description: s.data.properties.Description,
    Details: s.data.properties.Details,
  }));
---
<aside class="-ml-[8px] mb-10 tracking-tight">
  <div class="lg:sticky lg:top-20">
    <!-- Mobile header row -->
    <div class="flex gap-8 flex-row items-center justify-between lg:hidden">
      <a href="/" class="hover:text-accent"><span class="font-medium text-2xl">Saketh Thota</span></a>
      <div class="flex gap-2 items-center">
        <ModeToggle client:load />
        <a href="https://github.com/sakeththota/skth"><OpenInNewWindowIcon className="h-6 w-6 mr-2 hover:text-accent"/></a>
        <MobileNav client:load projects={projects} posts={posts} services={services} />
      </div>
    </div>

    <!-- Desktop nav -->
    <nav class="hidden lg:flex lg:items-start lg:justify-center px-0 pb-0">
      <ul class="flex flex-row gap-8 text-2xl font-medium">
        <li><a href="/" class="hover:text-accent">Saketh Thota</a></li>
        <li>|</li>
        {
          menuItems.map((item) => (
            <li>
              <a href={item.path} class="hover:text-accent">{item.title}</a>
            </li>
          ))
        }
        <li class="flex items-center gap-2">
          <ModeToggle client:load />
          <a href="https://github.com/sakeththota/skth"><OpenInNewWindowIcon className="h-6 w-6 hover:text-accent"/></a>
        </li>
      </ul>
    </nav>
  </div>
</aside>
