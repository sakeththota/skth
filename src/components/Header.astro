---
import { ModeToggle } from '@/components/ModeToggle';
import { MobileNav } from '@/components/MobileNav';
import { DesktopSearch } from '@/components/DesktopSearch';
import { DesktopNav } from '@/components/DesktopNav';
import { getCollection } from 'astro:content';

const menuItems = [
  { title: "Tutoring", path: "/tutoring" },
  { title: "Resume", path: "/resume" },
  { title: "Projects", path: "/projects" },
  { title: "Blog", path: "/blog" },
]

const pathname = Astro.url.pathname;

const projects = (await getCollection('projects', ({ data }) => !data.hidden))
  .sort((a, b) => b.data.id - a.data.id)
  .map((p) => ({
    title: p.data.title,
    description: p.data.description,
    tags: p.data.tags,
    source: p.data.source,
    live: p.data.live,
  }));

const posts = (await getCollection('blog', ({ data }) => !data.hidden))
  .sort((a, b) => a.data.idx - b.data.idx)
  .reverse()
  .map((p) => ({
    title: p.data.title,
    description: p.data.description,
    tags: p.data.tags,
    publishedAt: p.data.publishedAt,
    url: `/blog/${p.id}/`,
  }));

const services = (await getCollection('services'))
  .map((s) => ({
    Name: s.data.properties.Name,
    Description: s.data.properties.Description,
    Details: s.data.properties.Details,
  }));
---
<header class="mb-10">
  <div class="flex items-center justify-between py-5">
    {/* Logo */}
    <a href="/" class="fd-logo">Saketh Thota</a>

    {/* Desktop: nav links + search + mode toggle + github */}
    <div class="hidden lg:flex items-baseline gap-6">
      <DesktopNav client:load items={menuItems} pathname={pathname} />
      <div class="flex items-baseline gap-3">
        <DesktopSearch client:load projects={projects} posts={posts} services={services} />
        <ModeToggle client:load />
        <a href="https://github.com/sakeththota/skth" class="fd-text-icon" style="font-size: 0.875rem;" target="_blank" rel="noopener noreferrer">&#x2197;</a>
      </div>
    </div>

    {/* Mobile: mode toggle + github + hamburger */}
    <div class="flex lg:hidden items-center gap-3">
      <ModeToggle client:load />
      <a href="https://github.com/sakeththota/skth" class="fd-text-icon" style="font-size: 0.875rem;" target="_blank" rel="noopener noreferrer">&#x2197;</a>
      <MobileNav client:load projects={projects} posts={posts} services={services} />
    </div>
  </div>
  <div class="fd-rule-thick"></div>
</header>
